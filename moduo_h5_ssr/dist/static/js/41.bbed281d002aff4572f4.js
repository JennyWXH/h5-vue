webpackJsonp([41],{1095:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(138),i=n.n(o),r=n(886),a=n.n(r),s=n(67),l=n.n(s),c=n(343),d=(n.n(c),new l.a),m=void 0,h=void 0;e.default={data:function(){return{userInfo:null,serviceInfo:null,text:"",inputText:"",hasMore:!0,receive:[],status:0,reConnectTime:0}},created:function(){document.body.addEventListener("touchmove",this.scrollFn,!1),document.addEventListener("scroll",this.scrollFn,!1),this.vistorLogin()},destroyed:function(){document.body.removeEventListener("touchmove",this.scrollFn),document.removeEventListener("scroll",this.scrollFn)},computed:a()({},n.i(c.mapGetters)({baseRem:"baseRem"})),methods:{getHistoryList:function(t){var e=this,n=0;if(this.receive.length>0){n=this.receive[0].time}d.getModuoData("chat/msg/chatList",{userId:this.userInfo.userId,chatUserId:this.serviceInfo.userId,time:n,size:10}).then(function(n){if(1==n.data.status){console.log("res is",n.data.data);var o=n.data.data;o.length<10&&(e.hasMore=!1),e.receive=o.concat(e.receive),t&&(console.log("2222222222"),setTimeout(function(){window.scrollTo(0,document.body.scrollHeight)},10))}})},vistorLogin:function(){var t=this;d.getModuoData("chat/visitorLogin",{code:"3322222222223"}).then(function(e){1==e.data.status&&(console.log("-------------------------------"),t.userInfo=e.data.data.userInfo,t.serviceInfo=e.data.data.serviceInfo,t.getHistoryList(!0),t.createConnection())})},createConnection:function(){void 0!=window.WebSocket&&(m=new WebSocket("ws://192.168.1.128:9800/moduo/chat/websocket/"+this.userInfo.userId),m.onopen=this.wsOpen,m.onclose=this.wsClose,m.onmessage=this.wsMessage,m.onerror=this.wsError)},wsOpen:function(t){console.log("连接成功"),this.status=1,this.reConnectTime=0,this.sendHeartBeat()},wsClose:function(){console.log("Closed"),this.status=0},wsMessage:function(t){console.log(t.data);var e=JSON.parse(t.data);if("res-1002"==e.type){var n={content:this.inputText,type:2,img:this.serviceInfo.headImg,name:this.userInfo.name,userId:this.userInfo.userId};this.receive.push(n)}else if("req-1002"==e.type&&e.data.sendId==this.serviceInfo.userId){var n={content:e.data.content,type:1,img:this.serviceInfo.headImg,name:this.serviceInfo.name,userId:this.serviceInfo.userId};this.receive.push(n)}window.scrollTo(0,document.body.scrollHeight)},wsError:function(t){console.log("Error: "+t.data),this.reConnectTime>64||(this.connect(),0==this.reConnectTime?this.reConnectTime=2:this.reConnectTime*=2)},connect:function(){this.createConnection()},close:function(){window.clearInterval(h),h=null,this.receive=[],m&&(m.onclose(),m=null)},sendBtn:function(){if(0==this.status)alert("正在重连中"),this.connect();else{var t={type:"req-1002",data:{sendId:this.userInfo.userId,receiveId:this.serviceInfo.userId,content:this.inputText}};m.send(i()(t))}},scrollFn:function(){var t=document.body,e=Date.now();e<this.time+500||(this.time=e,t.scrollTop<=0&&this.hasMore&&this.getHistoryList())},sendHeartBeat:function(){window.clearInterval(h),h=null;h=setInterval(function(){var t={type:"req-1000",data:{}};m.send(i()(t))},18e4)}}}},1205:function(t,e,n){e=t.exports=n(837)(!1),e.push([t.i,"*{padding:0;margin:0}html{background-color:#fff!important;width:100%;font-size:.4rem}body,html{height:100%}body{display:block;margin:0 auto;width:7.5rem;max-width:750px;position:relative}body *{font-size:.4rem}body::-webkit-scrollbar{width:0}.commonDivider{display:inline-block;float:left;width:7.5rem;height:.02rem;background-color:#f5f5f5}.black30{color:#000}.black30,.gray30{font-size:.3rem;display:inline-block;line-height:.3rem}.gray30{color:gray}.black28{color:#000}.black28,.gray28{font-size:.28rem;display:inline-block;line-height:.29rem}.gray28{color:gray}.black26{color:#000}.black26,.gray26{font-size:.26rem;display:inline-block;line-height:.27rem}.gray24,.gray26{color:gray}.gray24{font-size:.24rem;display:inline-block;line-height:.27rem}.purple{color:#894eef}.titleView{width:100%;height:.8rem}.titleView .purpleLine{width:100%;height:.2rem;background-color:#894eef}.titleView span{display:inline-block;float:left;margin-left:.15rem;line-height:.8rem;font-size:.33rem}.titleView .titleLine{border-radius:.075rem;width:.15rem;margin-left:.2rem;height:.35rem;margin-top:.22rem;background-color:#894eef}.htmlContent{text-align:left;display:inline-block;width:7.1rem}.htmlContent img{width:auto;max-width:100%;display:block;margin:5px auto;-ms-flex-line-pack:center;align-content:center}.htmlContent p{font-size:16px;word-wrap:break-word}.htmlContent span{font-size:16px}.htmlContent embed,.htmlContent iframe{width:100%}",""])},1206:function(t,e,n){e=t.exports=n(837)(!1),e.push([t.i,".content[data-v-79809d78]{overflow:hidden;position:relative;background-color:#edeae8;margin-bottom:3rem}.content .left[data-v-79809d78],.content .right[data-v-79809d78]{width:5rem;margin-top:.5rem}.content .left img[data-v-79809d78],.content .right img[data-v-79809d78]{width:1rem;height:1rem;border-radius:.5rem;display:inline-block}.content .left span[data-v-79809d78],.content .right span[data-v-79809d78]{border-radius:.1rem;display:inline-block;line-height:.35rem;font-size:.3rem;margin-top:.1rem;word-wrap:break-word;max-width:3rem;text-align:left;padding:.25rem .3rem}.content .left[data-v-79809d78]{margin-left:.2rem;float:left}.content .left img[data-v-79809d78],.content .left span[data-v-79809d78]{float:left}.content .left span[data-v-79809d78]{background-color:#95c6f0;margin-left:.2rem}.content .right[data-v-79809d78]{margin-right:.1rem;float:right}.content .right img[data-v-79809d78],.content .right span[data-v-79809d78]{float:right}.content .right span[data-v-79809d78]{background-color:#a2e563;margin-right:.2rem}.bottomInput[data-v-79809d78]{position:fixed;bottom:0;width:7.5rem;height:1rem;background-color:hsla(240,4%,90%,.6);border-top:.005rem solid #e2e2e2}.bottomInput .inputType[data-v-79809d78]{display:block;position:relative;text-indent:.1rem;line-height:.59rem;float:left;background-color:#fff;margin:.2rem .1rem;width:6rem;height:.59rem;outline:none;border:.01rem solid #a9a9a9;font-size:.35rem;border-radius:.02rem}.bottomInput button[data-v-79809d78]{display:block;float:left;margin-top:.21rem;background:#32cd32;border-radius:.1rem;line-height:.6rem;font-size:.3rem;color:#fff;width:1.1rem;height:.6rem;border:0;outline:none}#app[data-v-79809d78]{min-height:100%;background-color:#edeae8;position:absolute;top:0;left:0;width:7.5rem;font-family:Avenir,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-align:center;color:#2c3e50;margin-top:0}",""])},1306:function(t,e,n){var o=n(1205);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);n(838)("2a0fa72f",o,!0)},1307:function(t,e,n){var o=n(1206);"string"==typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);n(838)("7f69d356",o,!0)},1428:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"content",attrs:{id:"contentId"}},t._l(t.receive,function(e){return n("div",[1==e.type?n("div",{staticClass:"left"},[n("img",{attrs:{src:e.img,alt:""}}),t._v(" "),n("span",[t._v(t._s(e.content))])]):n("div",{staticClass:"right"},[n("img",{attrs:{src:e.img,alt:""}}),t._v(" "),n("span",[t._v(t._s(e.content))])])])})),t._v(" "),n("div",{staticClass:"bottomInput"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.inputText,expression:"inputText"}],staticClass:"inputType",attrs:{type:"text",placeholder:"我也说几句..."},domProps:{value:t.inputText},on:{input:function(e){e.target.composing||(t.inputText=e.target.value)}}}),t._v(" "),n("button",{on:{click:function(e){t.sendBtn()}}},[t._v("发送")])])])},staticRenderFns:[]}},849:function(t,e,n){function o(t){n(1306),n(1307)}var i=n(66)(n(1095),n(1428),o,"data-v-79809d78",null);t.exports=i.exports},886:function(t,e,n){"use strict";e.__esModule=!0;var o=n(887),i=function(t){return t&&t.__esModule?t:{default:t}}(o);e.default=i.default||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}},887:function(t,e,n){t.exports={default:n(888),__esModule:!0}},888:function(t,e,n){n(890),t.exports=n(28).Object.assign},889:function(t,e,n){"use strict";var o=n(79),i=n(204),r=n(99),a=n(344),s=n(345),l=Object.assign;t.exports=!l||n(98)(function(){var t={},e={},n=Symbol(),o="abcdefghijklmnopqrst";return t[n]=7,o.split("").forEach(function(t){e[t]=t}),7!=l({},t)[n]||Object.keys(l({},e)).join("")!=o})?function(t,e){for(var n=a(t),l=arguments.length,c=1,d=i.f,m=r.f;l>c;)for(var h,u=s(arguments[c++]),f=d?o(u).concat(d(u)):o(u),g=f.length,p=0;g>p;)m.call(u,h=f[p++])&&(n[h]=u[h]);return n}:l},890:function(t,e,n){var o=n(78);o(o.S+o.F,"Object",{assign:n(889)})}});